<!DOCTYPE html>

<html>

<head>

  <title>HotLogo@WebMSX</title>

  <meta charset="UTF-8">

  <link rel="shortcut icon" type="image/x-icon" href="https://github.com/arkanon/arkanon.github.io/blob/master/favicon.ico?raw=true">

  <script src="https://rawgit.com/turuslan/HackTimer/master/HackTimer.min.js"></script>
  <script src="https://rawgit.com/turuslan/HackTimer/master/HackTimerWorker.min.js"></script>
  <!--script src="https://rawgit.com/ppeccin/WebMSX/master/release/stable/4.0/embedded/wmsx.js"></script-->
  <script src="wmsx.js"></script>
  <script src="https://rawgit.com/naptha/tesseract.js/1.0.10/dist/tesseract.js"></script>
  <script src="https://rawgit.com/antimatter15/ocrad.js/master/ocrad.js"></script>

  <script>

 // WMSX.BASIC_ENTER     = cmd('mudecor 15 1 mudecf 15 mudect 6 mudecl 4 esc proporção')
    WMSX.BASIC_ENTER     = cmd('esc proporção')
    WMSX.BASIC_TYPE      = cmd('un pt 30 ul repita 360 [ pf 1 pe 1 ] mudeproporção 1 repita 360 [ pf 1 pd 1 ]')

 // WMSX.CARTRIDGE1_URL  = url( 'msxpro.com/hardware/roms/hotbit12.zip'      )
 // WMSX.CARTRIDGE1_URL  = url( 'msxpro.com/hardware/roms/expert11.zip'      )
    WMSX.CARTRIDGE2_URL  = url( 'icongames.com.br/msxfiles/apps/hotlogo.zip' )
    WMSX.DISKA_FILES_URL = git( 'arkanon','dipohlo','webmsx-disk.zip'        )
 // WMSX.STATE_URL       = git( 'arkanon','dipohlo','webmsx-hotlogo.wst'     )

    WMSX.MACHINE               = 'MSX1A'
    WMSX.CPU_TURBO_MODE        = 1
    WMSX.AUTO_POWER_ON_DELAY   = 0
    WMSX.SCREEN_CONTROL_BAR    = 1
    WMSX.SCREEN_DEFAULT_ASPECT = 1.0
    WMSX.SCREEN_DEFAULT_SCALE  = 0.5
 // WMSX.SCREEN_DEFAULT_SCALE  = 2.2

    function cmd(str)            { return str.replace(/ç/g,'').replace(/ã/g,'±') }
    function url(url)            { return 'https://cors-anywhere.herokuapp.com/' + url } // <http://alternativeto.net/software/cors-proxy>
    function git(user,repo,path) { return 'https://rawgit.com/' + user + '/' + repo + '/gh-pages/' + path }

    function progressUpdate(data)
    {
      var ocr  = document.getElementById('ocr-box-tesseract');
      var line = document.createElement('div');
      var pre  = document.createElement('pre')
      pre.appendChild(document.createTextNode(data.text))
      line.innerHTML = ''
      line.appendChild(pre)
      ocr.insertBefore(line, ocr.firstChild)
    }

    function capture()
    {

      s.src = c.toDataURL('image/png')

      document.querySelector('#ocr-box-ocrad').innerHTML = OCRAD(c)

      document.querySelector('#ss-screen').src = s.src
      document.querySelector('#ocr-box-tesseract').innerHTML = ''
      Tesseract.recognize( s.src, { lang: 'por' } ).then( function(data) { progressUpdate( data ) } )

    }

    window.onload = function()
    {
      c = document.getElementById('wmsx-screen-canvas')
      s = document.getElementById('ss')
      var i = document.getElementById('ss-screen')
      var w = WMSX.SCREEN_DEFAULT_SCALE * c.width
      var h = WMSX.SCREEN_DEFAULT_SCALE * c.height
      s.style.width  = w + 'px'
      s.style.height = h + 'px'
      i.width        = w
      i.height       = h
    }

    var c, s

   console.log(WMSX);

  </script>

  <style>

    @font-face
    {
      font-family: screen0;
      src: url(https://cors-anywhere.herokuapp.com/ateijelo.com/assets/misc/MSX-Screen0.ttf);
    }

    @font-face
    {
      font-family: screen1;
      src: url(https://cors-anywhere.herokuapp.com/ateijelo.com/assets/misc/MSX-Screen1.ttf);
    }

    body
    {
      margin: 5px;
      background: #292929 ;
    }

    a
    {
      text-decoration: none;
      outline: none;
      color: white;
    }

    #input-block,
    #wmsx-block,
    #ss-block,
    .ocr-block
    {
      display: inline-block;
      vertical-align: top;
    }

    #ss-block
    {
      cursor: url(https://www.carambis.com/static/new/programs/icon/ss_icon.png), auto !important;
    }

    #input-header,
    #wmsx-header,
    #ss-header,
    .ocr-header
    {
      font-family: sans-serif;
      color: white;
      display: block;
    }

    #input-header:hover,
    #wmsx-header:hover,
    .ocr-header:hover
    {
      color: red;
    }

    #wmsx
    {
      text-align: center;
    }

    pre
    {
      margin: 0;
    }

    #wmsx-screen
    {
      border: 0 !important;
    }

    #input,
    #wmsx-screen-canvas-outer,
    #ss,
    .ocr
    {
      border: 1px solid red;
    }

    #input,
    #wmsx-screen-canvas-outer,
    .ocr
    {
      background: white;
    }

    #input-box,
    #ocr-box-ocrad,
    #ocr-box-tesseract pre
    {
      font-family: screen1;
      font-size: 7px;
      font-smooth: never; /* not working */
      text-rendering: optimizeSpeed; /* not working */
      line-height: 8px;
      transform: scale(1.14,1);
      transform-origin: 0 0;
      color: black;
      border: 0;
      margin: 0;
      padding: 0;
      white-space: pre;
    }

    #input,
    .ocr
    {
      padding: 8px 16px;
      width: 240px;
      height: 192px;
      margin: 0;
    }

    #input-box
    {
      overflow: hidden;
      resize: none;
    }

  </style>

</head>

<body>

  <div id="input-block">
    <a id="input-header" href="http://ateijelo.com/blog/2016/09/13/making-an-msx-font" target="_blank">Input</a>
    <div id="input">
      <textarea id="input-box" rows="24" cols="30" wrap="soft" spellcheck="false">
HOT-LOGO versão 1.1
EPCOM 1986
Benvindo ao Logo
?mudecor 15 1 mudecf 15 mudec➜
t 6 mudecl 4 esc proporção
1,1
?un pt 30 ul repita 360 [ pf ➜
1 pe 1 ] mudeproporção 1 repi➜
ta 360 [ pf 1 pd 1 ]
</textarea>
    </div>
  </div>

  <div id="wmsx-block">
    <a id="wmsx-header" href="http://github.com/ppeccin/webmsx" target="_blank">WebMSX</a>
    <div id="wmsx"><div id="wmsx-screen"></div></div>
    <input type="button" value="Internacional" onclick="WMSX.room.fileLoader.readFromURL(); WMSX.room.machine.reset()">
    <input type="button" value="HotBit"        onclick="WMSX.room.fileLoader.readFromURL(url('msxpro.com/hardware/roms/hotbit12.zip'), WMSX.ROM, 'auto', true, true); WMSX.room.machine.reset()">
    <input type="button" value="Expert"        onclick="WMSX.room.fileLoader.readFromURL(url('msxpro.com/hardware/roms/expert11.zip'), WMSX.ROM, 'auto', true, true); WMSX.room.machine.reset()">
  </div>

  <div id="ss-block" onclick="capture()">
    <div id="ss-header">ScreenShot</div>
    <div id="ss"><img id="ss-screen"></div>
  </div>

  <div class="ocr-block">
    <a class="ocr-header" href="http://github.com/antimatter15/ocrad.js" target="_blank">OCR (ocrad)</a>
    <div class="ocr">
      <div id="ocr-box-ocrad">
      </div>
    </div>
  </div>

  <div class="ocr-block">
    <a class="ocr-header" href="http://github.com/naptha/tesseract.js" target="_blank">OCR (tesseract)</a>
    <div class="ocr">
      <div id="ocr-box-tesseract">
      </div>
    </div>
  </div>

</body>

</html>
